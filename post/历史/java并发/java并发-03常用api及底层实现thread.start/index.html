<!doctype html><html lang=zh data-figures class=page><head><title>【Java并发 03】常用API及底层实现——Thread.start | Chinese</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta name=description content="从源码层面解读 Thread.start"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@janedoe"><meta name=twitter:title content="【Java并发 03】常用API及底层实现——Thread.start"><meta name=twitter:image content="https://yaoyl.cn/images/thumbnail.png"><meta property="og:url" content="https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/java%E5%B9%B6%E5%8F%91/java%E5%B9%B6%E5%8F%91-03%E5%B8%B8%E7%94%A8api%E5%8F%8A%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0thread.start/"><meta property="og:title" content="【Java并发 03】常用API及底层实现——Thread.start"><meta property="og:description" content="从源码层面解读 Thread.start"><meta property="og:image" content="https://yaoyl.cn/images/thumbnail.png"><meta name=keywords content="Java,源码"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":"https:\/\/yaoyl.cn\/post\/%E5%8E%86%E5%8F%B2\/java%E5%B9%B6%E5%8F%91\/java%E5%B9%B6%E5%8F%91-03%E5%B8%B8%E7%94%A8api%E5%8F%8A%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0thread.start\/","name":"Chinese","headline":"【Java并发 03】常用API及底层实现——Thread.start","description":"从源码层面解读 Thread.start","url":"https:\/\/yaoyl.cn\/post\/%E5%8E%86%E5%8F%B2\/java%E5%B9%B6%E5%8F%91\/java%E5%B9%B6%E5%8F%91-03%E5%B8%B8%E7%94%A8api%E5%8F%8A%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0thread.start\/","datePublished":"2021-02-01T02:30:29Z","dateModified":"2021-02-01T02:30:29Z","keywords":["Java","源码"],"articleSection":["Java"],"author":{"@type":"Person","name":"map[name:Yunyao Long]"},"image":{"@type":"ImageObject","url":"https:\/\/yaoyl.cn\/images\/thumbnail.png"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https:\/\/yaoyl.cn\/logos\/logo.png"},"name":"Chinese"}}</script><link rel=apple-touch-icon sizes=180x180 href=https://yaoyl.cn/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://yaoyl.cn/icons/favicon-32x32.png><link rel=manifest href=https://yaoyl.cn/icons/site.webmanifest><link rel=canonical href=https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/java%E5%B9%B6%E5%8F%91/java%E5%B9%B6%E5%8F%91-03%E5%B8%B8%E7%94%A8api%E5%8F%8A%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0thread.start/><link rel=preload href=https://yaoyl.cn/css/styles.dc38388a8f0b890e788bd3a99b7495d14e7d5ac4359ed3b49abeb778497863b284ad4cc7e496ef58c84139295f9bafed82f5a41345eda86bd2d429cccb7c2596.css integrity="sha512-3Dg4io8LiQ54i9Opm3SV0U59WsQ1ntO0mr63eEl4Y7KErUzH5JbvWMhBOSlfm6/tgvWkE0XtqGvS1CnMy3wllg==" as=style crossorigin=anonymous><link rel=preload href=https://yaoyl.cn/zh/js/bundle.a218cea21dfa8b9c5346bc507dae1a9753e4e347b6bdb2e71b8684278779920ccb8c67121f2b77caa97cc3bb82e1f55b11cfea79e196aaafe8c20be128212e2b.js as=script integrity="sha512-ohjOoh36i5xTRrxQfa4al1Pk40e2vbLnG4aEJ4d5kgzLjGcSHyt3yql8w7uC4fVbEc/qeeGWqq/owgvhKCEuKw==" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://yaoyl.cn/css/styles.dc38388a8f0b890e788bd3a99b7495d14e7d5ac4359ed3b49abeb778497863b284ad4cc7e496ef58c84139295f9bafed82f5a41345eda86bd2d429cccb7c2596.css integrity="sha512-3Dg4io8LiQ54i9Opm3SV0U59WsQ1ntO0mr63eEl4Y7KErUzH5JbvWMhBOSlfm6/tgvWkE0XtqGvS1CnMy3wllg==" crossorigin=anonymous></head><body data-code=7 data-lines=false id=documentTop data-lang=zh><header class=nav_header><nav class=nav><a href=https://yaoyl.cn/ class="nav_brand nav_item" title=Chinese><img src=https://yaoyl.cn/logos/logo.png class=logo alt=Chinese><div class=nav_close><div><svg class="icon"><title>open-menu</title><use xlink:href="#open-menu"/></svg>
<svg class="icon"><title>closeme</title><use xlink:href="#closeme"/></svg></div></div></a><div class='nav_body nav_body_left'><div class=nav_parent><a href=https://yaoyl.cn/ class=nav_item title=主页>主页</a></div><div class=nav_parent><a href=https://yaoyl.cn/post/2025/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB-%E5%89%8D%E7%9E%BB/ class=nav_item title=加精>加精</a></div><div class=nav_parent><a href=https://yaoyl.cn/ class=nav_item title=外链>外链 <img src=https://yaoyl.cn/icons/caret-icon.svg alt=icon class=nav_icon></a><div class=nav_sub><span class=nav_child></span>
<a href=https://www.linkedin.com/ class="nav_child nav_item" title=LinkedIn>LinkedIn</a></div></div><div class=nav_parent><a href=https://yaoyl.cn/about/ class=nav_item title=关于我>关于我</a></div><div class=nav_parent><a href=# class=nav_item></a><div class=nav_sub><span class=nav_child></span>
<a href=https://yaoyl.cn/en/ class="nav_child nav_item">English</a>
<a href=https://yaoyl.cn/pt/ class="nav_child nav_item">Português</a>
<a href=https://yaoyl.cn/ class="nav_child nav_item">中文</a></div></div><div class=follow><a href=https://github.com/YunyaoLong><svg class="icon"><title>github</title><use xlink:href="#github"/></svg>
</a><a href=https://www.linkedin.com/in/yunyaolong/><svg class="icon"><title>linkedin</title><use xlink:href="#linkedin"/></svg></a><div class=color_mode><input type=checkbox class=color_choice id=mode></div></div></div></nav></header><main><div class="grid-inverse wrap content"><article class=post_content><h1 class=post_title>【Java并发 03】常用API及底层实现——Thread.start</h1><div class=post_meta><span><svg class="icon"><title>calendar</title><use xlink:href="#calendar"/></svg>
</span><span class=post_date>Feb 1, 2021
</span><span class=post_time>· 7 分钟阅读</span><span>&nbsp;· <a href=https://yaoyl.cn/tags/java/ title=Java class="post_tag button button_translucent">Java
</a><a href=https://yaoyl.cn/tags/%E6%BA%90%E7%A0%81/ title=源码 class="post_tag button button_translucent">源码
</a></span><span class=page_only>&nbsp;·<div class=post_share>分享到:
<a href="https://twitter.com/intent/tweet?text=%e3%80%90Java%e5%b9%b6%e5%8f%91%2003%e3%80%91%e5%b8%b8%e7%94%a8API%e5%8f%8a%e5%ba%95%e5%b1%82%e5%ae%9e%e7%8e%b0%e2%80%94%e2%80%94Thread.start&url=https%3a%2f%2fyaoyl.cn%2fpost%2f%25E5%258E%2586%25E5%258F%25B2%2fjava%25E5%25B9%25B6%25E5%258F%2591%2fjava%25E5%25B9%25B6%25E5%258F%2591-03%25E5%25B8%25B8%25E7%2594%25A8api%25E5%258F%258A%25E5%25BA%2595%25E5%25B1%2582%25E5%25AE%259E%25E7%258E%25B0thread.start%2f&tw_p=tweetbutton" class=twitter title="分享到 Twitter" target=_blank rel=nofollow><svg class="icon"><title>twitter</title><use xlink:href="#twitter"/></svg>
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fyaoyl.cn%2fpost%2f%25E5%258E%2586%25E5%258F%25B2%2fjava%25E5%25B9%25B6%25E5%258F%2591%2fjava%25E5%25B9%25B6%25E5%258F%2591-03%25E5%25B8%25B8%25E7%2594%25A8api%25E5%258F%258A%25E5%25BA%2595%25E5%25B1%2582%25E5%25AE%259E%25E7%258E%25B0thread.start%2f&t=%e3%80%90Java%e5%b9%b6%e5%8f%91%2003%e3%80%91%e5%b8%b8%e7%94%a8API%e5%8f%8a%e5%ba%95%e5%b1%82%e5%ae%9e%e7%8e%b0%e2%80%94%e2%80%94Thread.start" class=facebook title="分享到 Facebook" target=_blank rel=nofollow><svg class="icon"><title>facebook</title><use xlink:href="#facebook"/></svg>
</a><a href=#linkedinshare id=linkedinshare class=linkedin title="分享到 LinkedIn" rel=nofollow><svg class="icon"><title>linkedin</title><use xlink:href="#linkedin"/></svg>
</a><a href=https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/java%E5%B9%B6%E5%8F%91/java%E5%B9%B6%E5%8F%91-03%E5%B8%B8%E7%94%A8api%E5%8F%8A%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0thread.start/ title="Copy Link" class="link link_yank"><svg class="icon"><title>copy</title><use xlink:href="#copy"/></svg></a></div></span></div><div class=post_toc><h2>文章目录</h2><nav id=TableOfContents><ul><li><a href=#太长不看>太长不看</a></li><li><a href=#native方法>native方法</a></li><li><a href=#线程创建>线程创建</a><ul><li><a href=#api>API</a></li><li><a href=#底层实现>底层实现</a></li><li><a href=#总结>总结</a></li></ul></li></ul></nav></div><div class=post_body><blockquote><p>龙云尧个人博客，转载请注明出处。
CSDN地址：http://blog.csdn.net/michael753951
个人blog地址：http://yaoyl.cn</p></blockquote><h1 id=知识储备>知识储备</h1><p>上一章节中我们讨论了Thread的状态转换，以及Thread状态和OS状态之间的映射关系。本章节开始进行发散，来看看常用的Thread操作相关的API有哪些。</p><p>本部分所有内容，JDK和JVM信息如下：</p><blockquote><p>java version "15.0.1" 2020-10-20
Java(TM) SE Runtime Environment (build 15.0.1+9-18)
Java HotSpot(TM) 64-Bit Server VM (build 15.0.1+9-18, mixed mode, sharing)</p></blockquote><p>Oracle JDK 15从官网可以直接下载，HotSpot源码参见如下：</p><ol><li>HotSpot的开源项目位于：<a href=https://github.com/openjdk/jdk>OpenJDK/JDK</a>；</li><li>源代码仓库为：<a href=https://github.com/openjdk/jdk.git>OpenJdk</a>；</li><li>仓库中源代码对应JDK 15的TAG为<code>jdk-15-ga</code>；</li><li>我的所有中文注释均上传在我个人fork出来的仓库中，参见<a href=https://github.com/YunyaoLong/jdk>YunyaoLong/jdk</a>，提交分支为<code>jdk-15-ga-ch-cn</code></li></ol><h2 id=太长不看>太长不看</h2><p>线程的创建其实是JVM将操作系统的线程创建做了一次二次封装。</p><p>整体主要的线程创建的流程为：</p><ol><li>计算线程所需要的内存空间；</li><li>向操作系统申请创建一个线程；</li><li>对该线程设置优先级；</li><li>将线程加入线程队列；</li><li>将线程的状态设置成RUNNABLE并且让操作系统尝试唤醒。</li></ol><p>这由于不同的操作系统对于线程的优先级的设置的范围不一样，因此在代码开发过程中，<strong>不建议针对线程设置不同的优先级</strong>。</p><p>如果一定需要设置优先级，也建议<strong>尽可能地减少优先级的梯度</strong>，同时让这些优先级尽可能均匀的分散在<code>java.lang.Thread#MIN_PRIORITY</code>和<code>java.lang.Thread#MAX_PRIORITY</code>之间（通常对应的是1-10）。</p><p>或者翻阅源码或者相关操作系统手册，确定自己优先级设置能够正常映射到对应的优先级上，否则就可能出现无法预料的线程调度错乱问题。</p><h2 id=native方法>native方法</h2><p>在看线程创建之前，我们首先要知道什么是native方法。</p><p>我们都知道，在Java中我们的所有代码都是在JVM中运行的，JVM通过一次虚拟化，对上层代码屏蔽了下游OS和硬件的差异。但是我们在实际项目中又不可避免的需要对OS或者硬件做操作，比如操作文件，操作线程，获取键盘/摄像头输入等。</p><p>这时候就需要我们的JNI和native方法相互配合了。</p><p>Java定义了JNI(Java Native Interface, Java本地接口)用于Java程序片段和本地其他类型的语言进行交互和调用，所有的JNI定义完成后，均使用<code>native</code>关键字进行修饰。JVM则封装了对应的native方法用于接口的具体调用。</p><p>本次Thread相关的native方法均为C++编写，因此如果之前完全没有学习过C++的同学，先稍微学习一下C++的基础知识再继续往下看。</p><h2 id=线程创建>线程创建</h2><h3 id=api>API</h3><p>我们在上一章节中，知道了Thread的激活方法是<code>java.lang.Thread#start</code>。</p><p>该方法调用完成之后，JVM就会帮我们创建一个线程，并将其状态标记为NEW状态，并且放进操作系统的就绪队列。</p><p>当该线程被从操作系统拉出来执行后，状态将变成RUN，并开始真正进行工作。</p><h3 id=底层实现>底层实现</h3><h4 id=jvm中的start0方法>JVM中的start0方法</h4><p>通过跟踪源代码，我们可以发现线程的创建实际上是通过一个<code>java.lang.Thread#start0</code>native方法具体实现的。</p><p>（这里其实可以发现start0仅会被start方法调用，也说明了线程的创建方式有且只有<code>java.lang.Thread#start</code>）</p><p>通过代码追踪，我们首先可以找到start0的入口函数位置，位于<code>src\java.base\share\native\libjava</code>中的<code>Thread.c</code>库，在这个库中，HotSpo定义了一组关系：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln> 1</span><span class=cl><span class=k>static</span> <span class=n>JNINativeMethod</span> <span class=n>methods</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=p>{</span><span class=s>&#34;start0&#34;</span><span class=p>,</span>           <span class=s>&#34;()V&#34;</span><span class=p>,</span>        <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_StartThread</span><span class=p>},</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=p>{</span><span class=s>&#34;stop0&#34;</span><span class=p>,</span>            <span class=s>&#34;(&#34;</span> <span class=n>OBJ</span> <span class=s>&#34;)V&#34;</span><span class=p>,</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_StopThread</span><span class=p>},</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=p>{</span><span class=s>&#34;isAlive&#34;</span><span class=p>,</span>          <span class=s>&#34;()Z&#34;</span><span class=p>,</span>        <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_IsThreadAlive</span><span class=p>},</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=p>{</span><span class=s>&#34;suspend0&#34;</span><span class=p>,</span>         <span class=s>&#34;()V&#34;</span><span class=p>,</span>        <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_SuspendThread</span><span class=p>},</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=p>{</span><span class=s>&#34;resume0&#34;</span><span class=p>,</span>          <span class=s>&#34;()V&#34;</span><span class=p>,</span>        <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_ResumeThread</span><span class=p>},</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=p>{</span><span class=s>&#34;setPriority0&#34;</span><span class=p>,</span>     <span class=s>&#34;(I)V&#34;</span><span class=p>,</span>       <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_SetThreadPriority</span><span class=p>},</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=p>{</span><span class=s>&#34;yield&#34;</span><span class=p>,</span>            <span class=s>&#34;()V&#34;</span><span class=p>,</span>        <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_Yield</span><span class=p>},</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=p>{</span><span class=s>&#34;sleep&#34;</span><span class=p>,</span>            <span class=s>&#34;(J)V&#34;</span><span class=p>,</span>       <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_Sleep</span><span class=p>},</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=p>{</span><span class=s>&#34;currentThread&#34;</span><span class=p>,</span>    <span class=s>&#34;()&#34;</span> <span class=n>THD</span><span class=p>,</span>     <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_CurrentThread</span><span class=p>},</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=p>{</span><span class=s>&#34;interrupt0&#34;</span><span class=p>,</span>       <span class=s>&#34;()V&#34;</span><span class=p>,</span>        <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_Interrupt</span><span class=p>},</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=p>{</span><span class=s>&#34;holdsLock&#34;</span><span class=p>,</span>        <span class=s>&#34;(&#34;</span> <span class=n>OBJ</span> <span class=s>&#34;)Z&#34;</span><span class=p>,</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_HoldsLock</span><span class=p>},</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=p>{</span><span class=s>&#34;getThreads&#34;</span><span class=p>,</span>        <span class=s>&#34;()[&#34;</span> <span class=n>THD</span><span class=p>,</span>   <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_GetAllThreads</span><span class=p>},</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=p>{</span><span class=s>&#34;dumpThreads&#34;</span><span class=p>,</span>      <span class=s>&#34;([&#34;</span> <span class=n>THD</span> <span class=s>&#34;)[[&#34;</span> <span class=n>STE</span><span class=p>,</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_DumpThreads</span><span class=p>},</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=p>{</span><span class=s>&#34;setNativeName&#34;</span><span class=p>,</span>    <span class=s>&#34;(&#34;</span> <span class=n>STR</span> <span class=s>&#34;)V&#34;</span><span class=p>,</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>JVM_SetNativeThreadName</span><span class=p>},</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>因此我们的start0就对应了其中的<code>JVM_StartThread</code>方法。</p><p>因此我们继续查阅到<code>src/hotspot/share/include/jvm.h</code>库头，发现了其中的<code>JVM_StartThread</code>方法。对应的，我们找到其实现类<code>src\hotspot\share\prims\jvm.cpp</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln> 1</span><span class=cl><span class=n>JVM_ENTRY</span><span class=p>(</span><span class=kt>void</span><span class=p>,</span> <span class=n>JVM_StartThread</span><span class=p>(</span><span class=n>JNIEnv</span><span class=o>*</span> <span class=n>env</span><span class=p>,</span> <span class=n>jobject</span> <span class=n>jthread</span><span class=p>))</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=n>JVMWrapper</span><span class=p>(</span><span class=s>&#34;JVM_StartThread&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=n>JavaThread</span> <span class=o>*</span><span class=n>native_thread</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=c1>// 线程操作的锁获取标记
</span></span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=kt>bool</span> <span class=n>throw_illegal_thread_state</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=c1>// 线程对象的空间申请代码块
</span></span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=c1>// 尝试获取锁
</span></span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=n>MutexLocker</span> <span class=nf>mu</span><span class=p>(</span><span class=n>Threads_lock</span><span class=p>);</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=c1>// 保证线程由于Thread.state为后期(Java 1.5)引入，因此需要确定state非null，防止查询Thread.state时出现空指针异常
</span></span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>java_lang_Thread</span><span class=o>::</span><span class=kr>thread</span><span class=p>(</span><span class=n>JNIHandles</span><span class=o>::</span><span class=n>resolve_non_null</span><span class=p>(</span><span class=n>jthread</span><span class=p>))</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>      <span class=n>throw_illegal_thread_state</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>      <span class=c1>// 计算线程的栈空间
</span></span></span><span class=line><span class=ln>17</span><span class=cl>      <span class=n>jlong</span> <span class=n>size</span> <span class=o>=</span> <span class=n>java_lang_Thread</span><span class=o>::</span><span class=n>stackSize</span><span class=p>(</span><span class=n>JNIHandles</span><span class=o>::</span><span class=n>resolve_non_null</span><span class=p>(</span><span class=n>jthread</span><span class=p>));</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>      <span class=c1>// 为native_thread申请内存空间（申请32位还是64位视操作系统决定，所以是使用size_t防止爆int）
</span></span></span><span class=line><span class=ln>19</span><span class=cl>      <span class=n>NOT_LP64</span><span class=p>(</span><span class=k>if</span> <span class=p>(</span><span class=n>size</span> <span class=o>&gt;</span> <span class=n>SIZE_MAX</span><span class=p>)</span> <span class=n>size</span> <span class=o>=</span> <span class=n>SIZE_MAX</span><span class=p>;)</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>      <span class=n>size_t</span> <span class=n>sz</span> <span class=o>=</span> <span class=n>size</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=p>(</span><span class=n>size_t</span><span class=p>)</span> <span class=nl>size</span> <span class=p>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>      <span class=n>native_thread</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JavaThread</span><span class=p>(</span><span class=o>&amp;</span><span class=n>thread_entry</span><span class=p>,</span> <span class=n>sz</span><span class=p>);</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>
</span></span><span class=line><span class=ln>23</span><span class=cl>      <span class=c1>// 防止操作系统因为内存不足而导致native_thread创建失败
</span></span></span><span class=line><span class=ln>24</span><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>native_thread</span><span class=o>-&gt;</span><span class=n>osthread</span><span class=p>()</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>        <span class=c1>// 标记当前线程的状态为prepare
</span></span></span><span class=line><span class=ln>26</span><span class=cl>        <span class=n>native_thread</span><span class=o>-&gt;</span><span class=n>prepare</span><span class=p>(</span><span class=n>jthread</span><span class=p>);</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>
</span></span><span class=line><span class=ln>31</span><span class=cl>  <span class=c1>// 检查JNI传入的线程对象的状态，如果为空，就抛出异常
</span></span></span><span class=line><span class=ln>32</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>throw_illegal_thread_state</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    <span class=n>THROW</span><span class=p>(</span><span class=n>vmSymbols</span><span class=o>::</span><span class=n>java_lang_IllegalThreadStateException</span><span class=p>());</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>
</span></span><span class=line><span class=ln>36</span><span class=cl>  <span class=c1>// 断言native_thread已经成功分配到对象空间
</span></span></span><span class=line><span class=ln>37</span><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>native_thread</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>,</span> <span class=s>&#34;Starting null thread?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>
</span></span><span class=line><span class=ln>39</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>native_thread</span><span class=o>-&gt;</span><span class=n>osthread</span><span class=p>()</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>    <span class=c1>// 如果native_thread对象空间中，没有实际申请到OS线程，进行异常处理并且抛出异常
</span></span></span><span class=line><span class=ln>41</span><span class=cl>    <span class=n>native_thread</span><span class=o>-&gt;</span><span class=n>smr_delete</span><span class=p>();</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>JvmtiExport</span><span class=o>::</span><span class=n>should_post_resource_exhausted</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>      <span class=n>JvmtiExport</span><span class=o>::</span><span class=n>post_resource_exhausted</span><span class=p>(</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>        <span class=n>JVMTI_RESOURCE_EXHAUSTED_OOM_ERROR</span> <span class=o>|</span> <span class=n>JVMTI_RESOURCE_EXHAUSTED_THREADS</span><span class=p>,</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>        <span class=n>os</span><span class=o>::</span><span class=n>native_thread_creation_failed_msg</span><span class=p>());</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>    <span class=n>THROW_MSG</span><span class=p>(</span><span class=n>vmSymbols</span><span class=o>::</span><span class=n>java_lang_OutOfMemoryError</span><span class=p>(),</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>              <span class=n>os</span><span class=o>::</span><span class=n>native_thread_creation_failed_msg</span><span class=p>());</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>
</span></span><span class=line><span class=ln>51</span><span class=cl><span class=c1>// 如果有加载Java Flight Recorder工具，针对JFR做特殊处理
</span></span></span><span class=line><span class=ln>52</span><span class=cl><span class=cp>#if INCLUDE_JFR
</span></span></span><span class=line><span class=ln>53</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>Jfr</span><span class=o>::</span><span class=n>is_recording</span><span class=p>()</span> <span class=o>&amp;&amp;</span> <span class=n>EventThreadStart</span><span class=o>::</span><span class=n>is_enabled</span><span class=p>()</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>      <span class=n>EventThreadStart</span><span class=o>::</span><span class=n>is_stacktrace_enabled</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>    <span class=n>JfrThreadLocal</span><span class=o>*</span> <span class=n>tl</span> <span class=o>=</span> <span class=n>native_thread</span><span class=o>-&gt;</span><span class=n>jfr_thread_local</span><span class=p>();</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>    <span class=c1>// skip Thread.start() and Thread.start0()
</span></span></span><span class=line><span class=ln>57</span><span class=cl>    <span class=n>tl</span><span class=o>-&gt;</span><span class=n>set_cached_stack_trace_id</span><span class=p>(</span><span class=n>JfrStackTraceRepository</span><span class=o>::</span><span class=n>record</span><span class=p>(</span><span class=kr>thread</span><span class=p>,</span> <span class=mi>2</span><span class=p>));</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>59</span><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=ln>60</span><span class=cl>
</span></span><span class=line><span class=ln>61</span><span class=cl>  <span class=c1>// 调用Thread::start方法开始进行线程操作
</span></span></span><span class=line><span class=ln>62</span><span class=cl>  <span class=n>Thread</span><span class=o>::</span><span class=n>start</span><span class=p>(</span><span class=n>native_thread</span><span class=p>);</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>
</span></span><span class=line><span class=ln>64</span><span class=cl><span class=n>JVM_END</span>
</span></span></code></pre></div><p>其中有几个比较重要的函数：</p><ol><li>线程对象创建函数<code>new JavaThread(&amp;thread_entry, sz)</code></li><li>OS线程查看入口<code>native_thread->osthread()</code></li><li>线程状态初始化函数<code>native_thread->prepare(jthread)</code></li><li>线程启动函数<code>Thread::start(native_thread)</code></li></ol><p>为了深入理解这些函数，我们一个一个展开这些代码的具体实现。</p><h4 id=javathread对象及构造函数>JavaThread对象及构造函数</h4><p><code>JavaThread</code>的结构定义位于<code>src/hotspot/share/runtime/thread.hpp</code>。</p><p>其中定义的参数比较多，不建议挨个查看作用，整体和Thread的关系可以参考官方注释中的结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// - Thread
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1>//   - JavaThread
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1>//     - various subclasses eg CompilerThread, ServiceThread
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1>//   - NonJavaThread
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1>//     - NamedThread
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1>//       - VMThread
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1>//       - ConcurrentGCThread
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1>//       - WorkerThread
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1>//         - GangWorker
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1>//     - WatcherThread
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1>//     - JfrThreadSampler
</span></span></span></code></pre></div><p>JavaThread构造函数的具体实现参见<code>src/hotspot/share/runtime/thread.cpp</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln> 1</span><span class=cl><span class=n>JavaThread</span><span class=o>::</span><span class=n>JavaThread</span><span class=p>(</span><span class=n>ThreadFunction</span> <span class=n>entry_point</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>stack_sz</span><span class=p>)</span> <span class=o>:</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>                       <span class=n>Thread</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=n>initialize</span><span class=p>();</span> <span class=c1>// JavaThread对象的参数初始化，不建议细看
</span></span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=n>_jni_attach_state</span> <span class=o>=</span> <span class=n>_not_attaching_via_jni</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=n>set_entry_point</span><span class=p>(</span><span class=n>entry_point</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=c1>// 定义需要创建的线程为java_thread
</span></span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=n>os</span><span class=o>::</span><span class=n>ThreadType</span> <span class=n>thr_type</span> <span class=o>=</span> <span class=n>os</span><span class=o>::</span><span class=n>java_thread</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=n>thr_type</span> <span class=o>=</span> <span class=n>entry_point</span> <span class=o>==</span> <span class=o>&amp;</span><span class=n>compiler_thread_entry</span> <span class=o>?</span> <span class=n>os</span><span class=o>::</span><span class=nl>compiler_thread</span> <span class=p>:</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>                                                     <span class=n>os</span><span class=o>::</span><span class=n>java_thread</span><span class=p>;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=c1>// 调用线程创建接口
</span></span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=n>os</span><span class=o>::</span><span class=n>create_thread</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>thr_type</span><span class=p>,</span> <span class=n>stack_sz</span><span class=p>);</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=c1>// 以下内容主要自官方注释：
</span></span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=c1>// 当操作系统没有可分配的内存的时候，_osthread有可能返回NULL。
</span></span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=c1>// 但是此时我们又不能抛出OOM Error，因为调用方此时可能持有了一把锁（参见上方的mu(Threads_lock)），这些锁必须在抛出异常前释放掉。如果我们需要抛出的异常，就需要为这个Exception对象申请内存，并初始化异常对象，此时可能已经没有足够内存了，这种行为就有可能锁回收失败。
</span></span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=c1>// 因此建议JVM先释放所有的锁，然后Java代码中如果发现线程申请失败的话，自己抛出异常(也可以触发OOM Error)。（译者注: 然而好像目前主要的Java发行版，都没有针对这种场景抛出异常）
</span></span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=c1>//
</span></span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=c1>// 代码运行到这里的时候，线程依然保持挂起的状态。该线程必须由创建者(JVM)执行运行(start)动作。
</span></span></span><span class=line><span class=ln>18</span><span class=cl>  <span class=c1>// 此外，线程的创建者(JVM)需要调用Threads:add用于将创建之后的线程放入线程队列中，本处代码没有添加是因为每一个线程对象必须完全创建(而此处可能会创建失败)
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里又涉及到了一个接口——<code>os::create_thread(this, thr_type, stack_sz)</code>。我们继续深挖它。</p><h4 id=oscreate_thread方法>os:create_thread方法</h4><p>该方法的接口定义在<code>src\hotspot\share\runtime\os.hpp</code>，在不同的操作系统中，有不同的实现，参见<code>os_linux.cpp</code>、<code>os_windows.cpp</code>、<code>os_posix.cpp</code>、<code>os_aix.cpp</code>、<code>os_bsd.cpp</code>。</p><p>这里以linux系统中的实现<code>os_linux.cpp</code>为例，linux中的线程创建，使用的是标准的pthread库。</p><p><em>（windows使用的是<code>MSDN</code>的<code>_beginthreadex</code>方法，具体实现可以自行跟踪源码，本次不做展开）</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln>  1</span><span class=cl><span class=kt>bool</span> <span class=n>os</span><span class=o>::</span><span class=n>create_thread</span><span class=p>(</span><span class=n>Thread</span><span class=o>*</span> <span class=kr>thread</span><span class=p>,</span> <span class=n>ThreadType</span> <span class=n>thr_type</span><span class=p>,</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl>                       <span class=n>size_t</span> <span class=n>req_stack_size</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=kr>thread</span><span class=o>-&gt;</span><span class=n>osthread</span><span class=p>()</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>,</span> <span class=s>&#34;caller responsible&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>  4</span><span class=cl>
</span></span><span class=line><span class=ln>  5</span><span class=cl>  <span class=c1>// 创建一个OSThread对象
</span></span></span><span class=line><span class=ln>  6</span><span class=cl>  <span class=n>OSThread</span><span class=o>*</span> <span class=n>osthread</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OSThread</span><span class=p>(</span><span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span> <span class=c1>// 调用pd_initialize()接口并初始化两个入参
</span></span></span><span class=line><span class=ln>  7</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>osthread</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  8</span><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 10</span><span class=cl>
</span></span><span class=line><span class=ln> 11</span><span class=cl>  <span class=c1>// 设置线程类型(就是上方传入的java_thread)
</span></span></span><span class=line><span class=ln> 12</span><span class=cl>  <span class=n>osthread</span><span class=o>-&gt;</span><span class=n>set_thread_type</span><span class=p>(</span><span class=n>thr_type</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>
</span></span><span class=line><span class=ln> 14</span><span class=cl>  <span class=c1>// 设置当前线程状态为已分配(ALLOCATED)，但是还未初始化(INITIALIZED)
</span></span></span><span class=line><span class=ln> 15</span><span class=cl>  <span class=n>osthread</span><span class=o>-&gt;</span><span class=n>set_state</span><span class=p>(</span><span class=n>ALLOCATED</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>
</span></span><span class=line><span class=ln> 17</span><span class=cl>  <span class=kr>thread</span><span class=o>-&gt;</span><span class=n>set_osthread</span><span class=p>(</span><span class=n>osthread</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl>
</span></span><span class=line><span class=ln> 19</span><span class=cl>  <span class=c1>// 调用pthread库初始化线程属性
</span></span></span><span class=line><span class=ln> 20</span><span class=cl>  <span class=n>pthread_attr_t</span> <span class=n>attr</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl>  <span class=n>pthread_attr_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>attr</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>  <span class=n>pthread_attr_setdetachstate</span><span class=p>(</span><span class=o>&amp;</span><span class=n>attr</span><span class=p>,</span> <span class=n>PTHREAD_CREATE_DETACHED</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl>
</span></span><span class=line><span class=ln> 24</span><span class=cl>  <span class=c1>// 申请req_stack_size大小的线程。
</span></span></span><span class=line><span class=ln> 25</span><span class=cl>  <span class=n>size_t</span> <span class=n>stack_size</span> <span class=o>=</span> <span class=n>os</span><span class=o>::</span><span class=n>Posix</span><span class=o>::</span><span class=n>get_initial_stack_size</span><span class=p>(</span><span class=n>thr_type</span><span class=p>,</span> <span class=n>req_stack_size</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 26</span><span class=cl>  <span class=c1>// 在2.7和之前的glibc版本中，guard size的计算机制没有正确实现。
</span></span></span><span class=line><span class=ln> 27</span><span class=cl>  <span class=c1>// posix标准要求线程的栈空间中包含将guard pages的诉求，而Linux创建线程的时候，线程栈大小(stacksize)并没有包含guard pages的诉求。 
</span></span></span><span class=line><span class=ln> 28</span><span class=cl>  <span class=c1>// 因此，JVM通过手工计算保护页面的大小来调整请求的stack_size，以模仿适当的行为。
</span></span></span><span class=line><span class=ln> 29</span><span class=cl>  <span class=c1>// 但是，请注意最终计算出来的栈大小不要以0结尾，否则可能会出现栈溢出(overflow)。 在这种情况下，请勿不要添加guard pages的诉求。
</span></span></span><span class=line><span class=ln> 30</span><span class=cl>  <span class=n>size_t</span> <span class=n>guard_size</span> <span class=o>=</span> <span class=n>os</span><span class=o>::</span><span class=n>Linux</span><span class=o>::</span><span class=n>default_guard_size</span><span class=p>(</span><span class=n>thr_type</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl>  <span class=c1>// 设置glibc库中的guard page属性。
</span></span></span><span class=line><span class=ln> 32</span><span class=cl>  <span class=c1>// 由于get_static_tls_area_size()需要读取guard page属性，因此该方法必须在get_static_tls_area_size()之前调用。
</span></span></span><span class=line><span class=ln> 33</span><span class=cl>  <span class=n>pthread_attr_setguardsize</span><span class=p>(</span><span class=o>&amp;</span><span class=n>attr</span><span class=p>,</span> <span class=n>guard_size</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl>
</span></span><span class=line><span class=ln> 35</span><span class=cl>  <span class=n>size_t</span> <span class=n>stack_adjust_size</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>AdjustStackSizeForTLS</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl>    <span class=c1>// 为线程本地存储(Thread Local Storage, TLS)预留资源，参见get_static_tls_area_size().
</span></span></span><span class=line><span class=ln> 38</span><span class=cl>    <span class=n>stack_adjust_size</span> <span class=o>+=</span> <span class=n>get_static_tls_area_size</span><span class=p>(</span><span class=o>&amp;</span><span class=n>attr</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl>    <span class=n>stack_adjust_size</span> <span class=o>+=</span> <span class=n>guard_size</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl>
</span></span><span class=line><span class=ln> 43</span><span class=cl>  <span class=c1>// 根据操作系统的分页大小，让栈的诉求向上对齐
</span></span></span><span class=line><span class=ln> 44</span><span class=cl>  <span class=n>stack_adjust_size</span> <span class=o>=</span> <span class=n>align_up</span><span class=p>(</span><span class=n>stack_adjust_size</span><span class=p>,</span> <span class=n>os</span><span class=o>::</span><span class=n>vm_page_size</span><span class=p>());</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>stack_size</span> <span class=o>&lt;=</span> <span class=n>SIZE_MAX</span> <span class=o>-</span> <span class=n>stack_adjust_size</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>    <span class=n>stack_size</span> <span class=o>+=</span> <span class=n>stack_adjust_size</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 48</span><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>is_aligned</span><span class=p>(</span><span class=n>stack_size</span><span class=p>,</span> <span class=n>os</span><span class=o>::</span><span class=n>vm_page_size</span><span class=p>()),</span> <span class=s>&#34;stack_size not aligned&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>
</span></span><span class=line><span class=ln> 50</span><span class=cl>  <span class=kt>int</span> <span class=n>status</span> <span class=o>=</span> <span class=n>pthread_attr_setstacksize</span><span class=p>(</span><span class=o>&amp;</span><span class=n>attr</span><span class=p>,</span> <span class=n>stack_size</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 51</span><span class=cl>  <span class=n>assert_status</span><span class=p>(</span><span class=n>status</span> <span class=o>==</span> <span class=mi>0</span><span class=p>,</span> <span class=n>status</span><span class=p>,</span> <span class=s>&#34;pthread_attr_setstacksize&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 52</span><span class=cl>
</span></span><span class=line><span class=ln> 53</span><span class=cl>  <span class=n>ThreadState</span> <span class=n>state</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl>
</span></span><span class=line><span class=ln> 55</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln> 56</span><span class=cl>    <span class=n>pthread_t</span> <span class=n>tid</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 57</span><span class=cl>    <span class=c1>// 调用pthread_create创建线程，同时获取线程创建结果(0成功，其余失败)
</span></span></span><span class=line><span class=ln> 58</span><span class=cl>    <span class=kt>int</span> <span class=n>ret</span> <span class=o>=</span> <span class=n>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tid</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>attr</span><span class=p>,</span> <span class=p>(</span><span class=kt>void</span><span class=o>*</span> <span class=p>(</span><span class=o>*</span><span class=p>)(</span><span class=kt>void</span><span class=o>*</span><span class=p>))</span> <span class=n>thread_native_entry</span><span class=p>,</span> <span class=kr>thread</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>
</span></span><span class=line><span class=ln> 60</span><span class=cl>    <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>64</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 61</span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ret</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>      <span class=n>log_info</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=kr>thread</span><span class=p>)(</span><span class=s>&#34;Thread started (pthread id: &#34;</span> <span class=n>UINTX_FORMAT</span> <span class=s>&#34;, attributes: %s). &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>        <span class=p>(</span><span class=n>uintx</span><span class=p>)</span> <span class=n>tid</span><span class=p>,</span> <span class=n>os</span><span class=o>::</span><span class=n>Posix</span><span class=o>::</span><span class=n>describe_pthread_attr</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=o>&amp;</span><span class=n>attr</span><span class=p>));</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>      <span class=n>log_warning</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=kr>thread</span><span class=p>)(</span><span class=s>&#34;Failed to start thread - pthread_create failed (%s) for attributes: %s.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 66</span><span class=cl>        <span class=n>os</span><span class=o>::</span><span class=n>errno_name</span><span class=p>(</span><span class=n>ret</span><span class=p>),</span> <span class=n>os</span><span class=o>::</span><span class=n>Posix</span><span class=o>::</span><span class=n>describe_pthread_attr</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>),</span> <span class=o>&amp;</span><span class=n>attr</span><span class=p>));</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl>      <span class=c1>// Log some OS information which might explain why creating the thread failed.
</span></span></span><span class=line><span class=ln> 68</span><span class=cl>      <span class=n>log_info</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=kr>thread</span><span class=p>)(</span><span class=s>&#34;Number of threads approx. running in the VM: %d&#34;</span><span class=p>,</span> <span class=n>Threads</span><span class=o>::</span><span class=n>number_of_threads</span><span class=p>());</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl>      <span class=n>LogStream</span> <span class=nf>st</span><span class=p>(</span><span class=n>Log</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=kr>thread</span><span class=p>)</span><span class=o>::</span><span class=n>info</span><span class=p>());</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl>      <span class=n>os</span><span class=o>::</span><span class=n>Posix</span><span class=o>::</span><span class=n>print_rlimit_info</span><span class=p>(</span><span class=o>&amp;</span><span class=n>st</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 71</span><span class=cl>      <span class=n>os</span><span class=o>::</span><span class=n>print_memory_info</span><span class=p>(</span><span class=o>&amp;</span><span class=n>st</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl>      <span class=n>os</span><span class=o>::</span><span class=n>Linux</span><span class=o>::</span><span class=n>print_proc_sys_info</span><span class=p>(</span><span class=o>&amp;</span><span class=n>st</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 73</span><span class=cl>      <span class=n>os</span><span class=o>::</span><span class=n>Linux</span><span class=o>::</span><span class=n>print_container_info</span><span class=p>(</span><span class=o>&amp;</span><span class=n>st</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>
</span></span><span class=line><span class=ln> 76</span><span class=cl>    <span class=n>pthread_attr_destroy</span><span class=p>(</span><span class=o>&amp;</span><span class=n>attr</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 77</span><span class=cl>
</span></span><span class=line><span class=ln> 78</span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ret</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl>      <span class=c1>// 如果创建失败，则释放osthread申请的内存空间
</span></span></span><span class=line><span class=ln> 80</span><span class=cl>      <span class=kr>thread</span><span class=o>-&gt;</span><span class=n>set_osthread</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl>      <span class=k>delete</span> <span class=n>osthread</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 82</span><span class=cl>      <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 83</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>
</span></span><span class=line><span class=ln> 85</span><span class=cl>    <span class=c1>// 将创建完成的操作系统线程id缓存到osthread对象中
</span></span></span><span class=line><span class=ln> 86</span><span class=cl>    <span class=n>osthread</span><span class=o>-&gt;</span><span class=n>set_pthread_id</span><span class=p>(</span><span class=n>tid</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 87</span><span class=cl>
</span></span><span class=line><span class=ln> 88</span><span class=cl>    <span class=c1>// 如果自己的子线程还在初始化完成(处于ALLOCATED但是没有到INITIALIZED)
</span></span></span><span class=line><span class=ln> 89</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>      <span class=n>Monitor</span><span class=o>*</span> <span class=n>sync_with_child</span> <span class=o>=</span> <span class=n>osthread</span><span class=o>-&gt;</span><span class=n>startThread_lock</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 91</span><span class=cl>      <span class=n>MutexLocker</span> <span class=nf>ml</span><span class=p>(</span><span class=n>sync_with_child</span><span class=p>,</span> <span class=n>Mutex</span><span class=o>::</span><span class=n>_no_safepoint_check_flag</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl>      <span class=k>while</span> <span class=p>((</span><span class=n>state</span> <span class=o>=</span> <span class=n>osthread</span><span class=o>-&gt;</span><span class=n>get_state</span><span class=p>())</span> <span class=o>==</span> <span class=n>ALLOCATED</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 93</span><span class=cl>        <span class=n>sync_with_child</span><span class=o>-&gt;</span><span class=n>wait_without_safepoint_check</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl>
</span></span><span class=line><span class=ln> 98</span><span class=cl>  <span class=c1>// 如果当前线程已经是一个僵尸进程(ZOMBIE)，则手工释放osthread申请的内存空间
</span></span></span><span class=line><span class=ln> 99</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>state</span> <span class=o>==</span> <span class=n>ZOMBIE</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>100</span><span class=cl>    <span class=kr>thread</span><span class=o>-&gt;</span><span class=n>set_osthread</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=ln>101</span><span class=cl>    <span class=k>delete</span> <span class=n>osthread</span><span class=p>;</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>103</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>104</span><span class=cl>
</span></span><span class=line><span class=ln>105</span><span class=cl>  <span class=c1>// 线程创建完成，状态为INITIALIZED
</span></span></span><span class=line><span class=ln>106</span><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>state</span> <span class=o>==</span> <span class=n>INITIALIZED</span><span class=p>,</span> <span class=s>&#34;race condition&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>107</span><span class=cl>  <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>108</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>到这里操作系统线程已经通过pthread库创建完成了。我们start0方法也终于执行到了<code>native_thread = new JavaThread(&amp;thread_entry, sz);</code>这一行。</p><h4 id=osthread方法>osthread方法</h4><p>这个暂未找到在哪实现，但是其实我们看上面osthread的创建代码，其实就很容易何以知道这个方法就是返回<code>create_thread中</code>创建好的<code>osthread</code>。</p><h4 id=javathreadprepare方法>JavaThread::prepare方法</h4><p>再次回到我们的JavaThread实现类中来，我们看看prepare代码的具体实现。同样还是以Linux为例（注，在上文我们知道Linux使用的是pthread库进行的创建，也即posix标准线程）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln> 1</span><span class=cl><span class=kt>void</span> <span class=n>JavaThread</span><span class=o>::</span><span class=n>prepare</span><span class=p>(</span><span class=n>jobject</span> <span class=n>jni_thread</span><span class=p>,</span> <span class=n>ThreadPriority</span> <span class=n>prio</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>Threads_lock</span><span class=o>-&gt;</span><span class=n>owner</span><span class=p>()</span> <span class=o>==</span> <span class=n>Thread</span><span class=o>::</span><span class=n>current</span><span class=p>(),</span> <span class=s>&#34;must have threads lock&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>NoPriority</span> <span class=o>&lt;=</span> <span class=n>prio</span> <span class=o>&amp;&amp;</span> <span class=n>prio</span> <span class=o>&lt;=</span> <span class=n>MaxPriority</span><span class=p>,</span> <span class=s>&#34;sanity check&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=c1>// 使用Handle来绑定Java的Thread对象和C++的Thread
</span></span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=c1>// 使用JNIHandles从jni线程中获取C++的线程对象，并将其放入一个新的Handle封装类的变量thread_oop中。
</span></span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=c1>// 这个Handle主要用于共享该C++线程对象。
</span></span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=n>Handle</span> <span class=nf>thread_oop</span><span class=p>(</span><span class=n>Thread</span><span class=o>::</span><span class=n>current</span><span class=p>(),</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>                    <span class=n>JNIHandles</span><span class=o>::</span><span class=n>resolve_non_null</span><span class=p>(</span><span class=n>jni_thread</span><span class=p>));</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>InstanceKlass</span><span class=o>::</span><span class=n>cast</span><span class=p>(</span><span class=n>thread_oop</span><span class=o>-&gt;</span><span class=n>klass</span><span class=p>())</span><span class=o>-&gt;</span><span class=n>is_linked</span><span class=p>(),</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>         <span class=s>&#34;must be initialized&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=n>set_threadObj</span><span class=p>(</span><span class=n>thread_oop</span><span class=p>());</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=n>java_lang_Thread</span><span class=o>::</span><span class=n>set_thread</span><span class=p>(</span><span class=n>thread_oop</span><span class=p>(),</span> <span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>prio</span> <span class=o>==</span> <span class=n>NoPriority</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=n>prio</span> <span class=o>=</span> <span class=n>java_lang_Thread</span><span class=o>::</span><span class=n>priority</span><span class=p>(</span><span class=n>thread_oop</span><span class=p>());</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>prio</span> <span class=o>!=</span> <span class=n>NoPriority</span><span class=p>,</span> <span class=s>&#34;A valid priority should be present&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>
</span></span><span class=line><span class=ln>22</span><span class=cl>  <span class=c1>// 将线程的优先级设置成 Java中优先级 映射之后的 实际操作系统的线程优先级
</span></span></span><span class=line><span class=ln>23</span><span class=cl>  <span class=n>Thread</span><span class=o>::</span><span class=n>set_priority</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>prio</span><span class=p>);</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>
</span></span><span class=line><span class=ln>25</span><span class=cl>  <span class=c1>// 将线程加入线程队列中，并且该线程进行激活。
</span></span></span><span class=line><span class=ln>26</span><span class=cl>  <span class=c1>// 调用Threads::add时需要持有该线程的锁。
</span></span></span><span class=line><span class=ln>27</span><span class=cl>  <span class=c1>// 至关重要的一点是，在我们线程加入线程队列动作执行挖成之后，我们需要释放该线程的锁
</span></span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=c1>// （也即JVM不会主动阻塞该线程），以防止GC无法回收该线程的内存。
</span></span></span><span class=line><span class=ln>29</span><span class=cl>  <span class=n>Threads</span><span class=o>::</span><span class=n>add</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=ln>30</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这其中调用了thread.cpp中的方法Thread::set_priority对优先级进行设置。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln>1</span><span class=cl><span class=kt>void</span> <span class=n>Thread</span><span class=o>::</span><span class=n>set_priority</span><span class=p>(</span><span class=n>Thread</span><span class=o>*</span> <span class=kr>thread</span><span class=p>,</span> <span class=n>ThreadPriority</span> <span class=n>priority</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>  <span class=n>debug_only</span><span class=p>(</span><span class=n>check_for_dangling_thread_pointer</span><span class=p>(</span><span class=kr>thread</span><span class=p>);)</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>  <span class=c1>// Can return an error!
</span></span></span><span class=line><span class=ln>4</span><span class=cl>  <span class=p>(</span><span class=kt>void</span><span class=p>)</span><span class=n>os</span><span class=o>::</span><span class=n>set_priority</span><span class=p>(</span><span class=kr>thread</span><span class=p>,</span> <span class=n>priority</span><span class=p>);</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Thread::set_priority调用了os.cpp中os::set_priority进行实际的优先级测试。代码位于<code>src\hotspot\share\runtime\os.cpp</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln> 1</span><span class=cl><span class=n>OSReturn</span> <span class=n>os</span><span class=o>::</span><span class=n>set_priority</span><span class=p>(</span><span class=n>Thread</span><span class=o>*</span> <span class=kr>thread</span><span class=p>,</span> <span class=n>ThreadPriority</span> <span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=n>debug_only</span><span class=p>(</span><span class=n>Thread</span><span class=o>::</span><span class=n>check_for_dangling_thread_pointer</span><span class=p>(</span><span class=kr>thread</span><span class=p>);)</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=k>if</span> <span class=p>((</span><span class=n>p</span> <span class=o>&gt;=</span> <span class=n>MinPriority</span> <span class=o>&amp;&amp;</span> <span class=n>p</span> <span class=o>&lt;=</span> <span class=n>MaxPriority</span><span class=p>)</span> <span class=o>||</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>      <span class=p>(</span><span class=n>p</span> <span class=o>==</span> <span class=n>CriticalPriority</span> <span class=o>&amp;&amp;</span> <span class=kr>thread</span><span class=o>-&gt;</span><span class=n>is_ConcurrentGC_thread</span><span class=p>()))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=kt>int</span> <span class=n>priority</span> <span class=o>=</span> <span class=n>java_to_os_priority</span><span class=p>[</span><span class=n>p</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=k>return</span> <span class=nf>set_native_priority</span><span class=p>(</span><span class=kr>thread</span><span class=p>,</span> <span class=n>priority</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=nb>false</span><span class=p>,</span> <span class=s>&#34;Should not happen&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=k>return</span> <span class=n>OS_ERR</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>方法设置中，有一个关键的优先级获取列表——java_to_os_priority。这个列表在不同的操作系统中，针对各个操作系统对于线程优先级的不同定义，进行了不同的实现。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// linux中优先级的实现，参见src\hotspot\os\linux\os_linux.cpp
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kt>int</span> <span class=n>os</span><span class=o>::</span><span class=n>java_to_os_priority</span><span class=p>[</span><span class=n>CriticalPriority</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=mi>19</span><span class=p>,</span>              <span class=c1>// 0 Entry should never be used
</span></span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl>   <span class=mi>4</span><span class=p>,</span>              <span class=c1>// 1 MinPriority
</span></span></span><span class=line><span class=ln> 6</span><span class=cl>   <span class=mi>3</span><span class=p>,</span>              <span class=c1>// 2
</span></span></span><span class=line><span class=ln> 7</span><span class=cl>   <span class=mi>2</span><span class=p>,</span>              <span class=c1>// 3
</span></span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>   <span class=mi>1</span><span class=p>,</span>              <span class=c1>// 4
</span></span></span><span class=line><span class=ln>10</span><span class=cl>   <span class=mi>0</span><span class=p>,</span>              <span class=c1>// 5 NormPriority
</span></span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=o>-</span><span class=mi>1</span><span class=p>,</span>              <span class=c1>// 6
</span></span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=o>-</span><span class=mi>2</span><span class=p>,</span>              <span class=c1>// 7
</span></span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=o>-</span><span class=mi>3</span><span class=p>,</span>              <span class=c1>// 8
</span></span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=o>-</span><span class=mi>4</span><span class=p>,</span>              <span class=c1>// 9 NearMaxPriority
</span></span></span><span class=line><span class=ln>16</span><span class=cl>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=o>-</span><span class=mi>5</span><span class=p>,</span>              <span class=c1>// 10 MaxPriority
</span></span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=o>-</span><span class=mi>5</span>               <span class=c1>// 11 CriticalPriority
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=p>};</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// Windows中的实现，参见src\hotspot\os\windows\os_windows.cpp
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kt>int</span> <span class=n>os</span><span class=o>::</span><span class=n>java_to_os_priority</span><span class=p>[</span><span class=n>CriticalPriority</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=n>THREAD_PRIORITY_IDLE</span><span class=p>,</span>                         <span class=c1>// 0  Entry should never be used
</span></span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=n>THREAD_PRIORITY_LOWEST</span><span class=p>,</span>                       <span class=c1>// 1  MinPriority
</span></span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=n>THREAD_PRIORITY_LOWEST</span><span class=p>,</span>                       <span class=c1>// 2
</span></span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=n>THREAD_PRIORITY_BELOW_NORMAL</span><span class=p>,</span>                 <span class=c1>// 3
</span></span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=n>THREAD_PRIORITY_BELOW_NORMAL</span><span class=p>,</span>                 <span class=c1>// 4
</span></span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=n>THREAD_PRIORITY_NORMAL</span><span class=p>,</span>                       <span class=c1>// 5  NormPriority
</span></span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=n>THREAD_PRIORITY_NORMAL</span><span class=p>,</span>                       <span class=c1>// 6
</span></span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=n>THREAD_PRIORITY_ABOVE_NORMAL</span><span class=p>,</span>                 <span class=c1>// 7
</span></span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=n>THREAD_PRIORITY_ABOVE_NORMAL</span><span class=p>,</span>                 <span class=c1>// 8
</span></span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=n>THREAD_PRIORITY_HIGHEST</span><span class=p>,</span>                      <span class=c1>// 9  NearMaxPriority
</span></span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=n>THREAD_PRIORITY_HIGHEST</span><span class=p>,</span>                      <span class=c1>// 10 MaxPriority
</span></span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=n>THREAD_PRIORITY_HIGHEST</span>                       <span class=c1>// 11 CriticalPriority
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h4 id=threadstart方法>Thread::start方法</h4><p>该方法的具体实现参见<code>src/hotspot/share/runtime/thread.cpp</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln> 1</span><span class=cl><span class=kt>void</span> <span class=n>Thread</span><span class=o>::</span><span class=n>start</span><span class=p>(</span><span class=n>Thread</span><span class=o>*</span> <span class=kr>thread</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=c1>// start和resume的区别在于，start方法的安全性是上下文或者Java代码中的Thread方法调用的
</span></span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>DisableStartThread</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=kr>thread</span><span class=o>-&gt;</span><span class=n>is_Java_thread</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>      <span class=c1>// 初始化线程状态为RUNNABLE。如果先调用start_thread启动线程，那么线程的状态将由于无法预知而不能准确设置上。（有可能没有被成功获取到线程锁(MONITOR_WAIT)或者休眠(SLEEPING)或者其他状态）
</span></span></span><span class=line><span class=ln> 6</span><span class=cl>      <span class=n>java_lang_Thread</span><span class=o>::</span><span class=n>set_thread_status</span><span class=p>(((</span><span class=n>JavaThread</span><span class=o>*</span><span class=p>)</span><span class=kr>thread</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>threadObj</span><span class=p>(),</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>                                          <span class=n>java_lang_Thread</span><span class=o>::</span><span class=n>RUNNABLE</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=n>os</span><span class=o>::</span><span class=n>start_thread</span><span class=p>(</span><span class=kr>thread</span><span class=p>);</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln>1</span><span class=cl><span class=kt>void</span> <span class=n>os</span><span class=o>::</span><span class=n>start_thread</span><span class=p>(</span><span class=n>Thread</span><span class=o>*</span> <span class=kr>thread</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>  <span class=n>MutexLocker</span> <span class=nf>ml</span><span class=p>(</span><span class=kr>thread</span><span class=o>-&gt;</span><span class=n>SR_lock</span><span class=p>(),</span> <span class=n>Mutex</span><span class=o>::</span><span class=n>_no_safepoint_check_flag</span><span class=p>);</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>  <span class=n>OSThread</span><span class=o>*</span> <span class=n>osthread</span> <span class=o>=</span> <span class=kr>thread</span><span class=o>-&gt;</span><span class=n>osthread</span><span class=p>();</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>  <span class=n>osthread</span><span class=o>-&gt;</span><span class=n>set_state</span><span class=p>(</span><span class=n>RUNNABLE</span><span class=p>);</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>  <span class=c1>// 将操作系统的线程的状态设置成RUNNABLE
</span></span></span><span class=line><span class=ln>6</span><span class=cl>  <span class=n>pd_start_thread</span><span class=p>(</span><span class=kr>thread</span><span class=p>);</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>同样以os_linux实现为例。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=ln>1</span><span class=cl><span class=kt>void</span> <span class=n>os</span><span class=o>::</span><span class=n>pd_start_thread</span><span class=p>(</span><span class=n>Thread</span><span class=o>*</span> <span class=kr>thread</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>  <span class=n>OSThread</span> <span class=o>*</span> <span class=n>osthread</span> <span class=o>=</span> <span class=kr>thread</span><span class=o>-&gt;</span><span class=n>osthread</span><span class=p>();</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>osthread</span><span class=o>-&gt;</span><span class=n>get_state</span><span class=p>()</span> <span class=o>!=</span> <span class=n>INITIALIZED</span><span class=p>,</span> <span class=s>&#34;just checking&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>  <span class=n>Monitor</span><span class=o>*</span> <span class=n>sync_with_child</span> <span class=o>=</span> <span class=n>osthread</span><span class=o>-&gt;</span><span class=n>startThread_lock</span><span class=p>();</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>  <span class=n>MutexLocker</span> <span class=nf>ml</span><span class=p>(</span><span class=n>sync_with_child</span><span class=p>,</span> <span class=n>Mutex</span><span class=o>::</span><span class=n>_no_safepoint_check_flag</span><span class=p>);</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>  <span class=c1>// 尝试唤起该osthread
</span></span></span><span class=line><span class=ln>7</span><span class=cl>  <span class=n>sync_with_child</span><span class=o>-&gt;</span><span class=n>notify</span><span class=p>();</span>
</span></span><span class=line><span class=ln>8</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=总结>总结</h3><p>写到这里，最后总结一下，通过源码阅读，我们其实已经不难发现在HotSpot虚机中，线程的创建其实是JVM将操作系统的线程创建做了一次二次封装。</p><p>整体主要的线程创建的流程为：</p><ol><li>计算线程所需要的内存空间；</li><li>向操作系统申请创建一个线程；</li><li>对该线程设置优先级；</li><li>将线程加入线程队列；</li><li>将线程的状态设置成RUNNABLE并且让操作系统尝试唤醒。</li></ol><p>时序图如下：</p><p><figure><picture><img loading=lazy decoding=async alt=线程调度时序图 class="image_figure image_internal image_processed" width=2081 height=2745 src=https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/java%E5%B9%B6%E5%8F%91/java%E5%B9%B6%E5%8F%91-03%E5%B8%B8%E7%94%A8api%E5%8F%8A%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0thread.start/%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6%E6%97%B6%E5%BA%8F%E5%9B%BE.png></picture></figure></p><p>这里面有一个比较重要的注意事项，由于不同的操作系统对于线程的优先级的设置的范围不一样（参见上方os::java_to_os_priority）。</p><p>因此在代码开发过程中，<strong>不建议针对线程设置不同的优先级</strong>。</p><p>如果一定需要设置优先级，也建议<strong>尽可能地减少优先级的梯度</strong>，同时让这些优先级尽可能均匀的分散在<code>java.lang.Thread#MIN_PRIORITY</code>和<code>java.lang.Thread#MAX_PRIORITY</code>之间（通常对应的是1-10）。</p><p>或者翻阅源码或者相关操作系统手册，确定自己优先级设置能够正常映射到对应的优先级上，否则就可能出现无法预料的线程调度错乱问题。</p></div><div class=post_comments></div></article><aside class=sidebar><section class=sidebar_inner><br><div class=search><input type=search class="search_field form_field" placeholder=搜索内容... id=find autocomplete=off data-scope=post>
<label for=find class=search_label><svg class="icon"><title>search</title><use xlink:href="#search"/></svg></label><div class="search_results results"></div></div><h2>Yunyao Long</h2><div class=author_bio>Coding for everything</div><a href=https://yaoyl.cn/about/ class="button mt-1" role=button title=阅读更多>阅读更多</a><h2 class=mt-4>精选文章</h2><ul><li><a href=https://yaoyl.cn/post/2025/%E5%9C%A8vscode%E4%B8%AD%E4%BD%BF%E7%94%A8continue%E6%8F%92%E4%BB%B6%E8%BF%9E%E6%8E%A5%E6%9C%AC%E5%9C%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B/ class=nav-link title=在VSCode中使用Continue插件连接本地大模型>在VSCode中使用Continue插件连接本地大模型</a></li><li><a href=https://yaoyl.cn/post/2025/%E8%BF%90%E8%A1%8C%E6%9C%AC%E5%9C%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B/ class=nav-link title=M1芯片MacBook搭建本地大模型>M1芯片MacBook搭建本地大模型</a></li><li><a href=https://yaoyl.cn/post/2025/m1%E8%8A%AF%E7%89%87macbook%E5%AE%89%E8%A3%85docker/ class=nav-link title=M1芯片MacBook安装Docker>M1芯片MacBook安装Docker</a></li></ul><h2 class=mt-4>最新文章</h2><ul class=flex-column><li><a href=https://yaoyl.cn/post/2025/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB-%E5%89%8D%E7%9E%BB/ class=nav-link title=技术分享-前瞻>技术分享-前瞻</a></li><li><a href=https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/java%E5%B9%B6%E5%8F%91/java%E5%B9%B6%E5%8F%91-03%E5%B8%B8%E7%94%A8api%E5%8F%8A%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0thread.start/ class=nav-link title="【Java并发 03】常用API及底层实现——Thread.start">【Java并发 03】常用API及底层实现——Thread.start</a></li><li><a href=https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/java%E5%B9%B6%E5%8F%91/java%E5%B9%B6%E5%8F%91-02thread%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1/ class=nav-link title="【Java并发 02】Thread由浅入深">【Java并发 02】Thread由浅入深</a></li><li><a href=https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/java%E5%B9%B6%E5%8F%91/java%E5%B9%B6%E5%8F%91-01java%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E5%88%9D%E7%AA%A5/ class=nav-link title="【Java并发 01】Java线程并发初窥">【Java并发 01】Java线程并发初窥</a></li><li><a href=https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/ class=nav-link title=设计模式-观察者模式>设计模式-观察者模式</a></li><li><a href=https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/uml%E7%B1%BB%E5%9B%BE%E7%BB%98%E5%88%B6%E5%AE%9E%E4%BE%8B/ class=nav-link title=UML类图绘制实例>UML类图绘制实例</a></li><li><a href=https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/spring%E7%9A%84bean%E7%AE%A1%E7%90%86/ class=nav-link title=Spring的Bean管理>Spring的Bean管理</a></li><li><a href=https://yaoyl.cn/post/%E5%8E%86%E5%8F%B2/%E4%B8%80%E7%82%B9%E7%82%B9%E6%89%8B%E5%86%99spring/ class=nav-link title=一点点手写Spring>一点点手写Spring</a></li></ul><div><h2 class="mt-4 taxonomy" id=categories-section>分类</h2><nav class=tags_nav><a href=https://yaoyl.cn/categories/c++/ class="post_tag button button_translucent" title=c++>C++
<span class=button_tally>17</span>
</a><a href=https://yaoyl.cn/categories/java/ class="post_tag button button_translucent" title=java>JAVA
<span class=button_tally>12</span>
</a><a href=https://yaoyl.cn/categories/%E9%9D%A2%E8%AF%95/ class="post_tag button button_translucent" title=面试>面试
<span class=button_tally>5</span>
</a><a href=https://yaoyl.cn/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/ class="post_tag button button_translucent" title=技术分享>技术分享
<span class=button_tally>4</span>
</a><a href=https://yaoyl.cn/categories/blog/ class="post_tag button button_translucent" title=blog>BLOG
<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/categories/python/ class="post_tag button button_translucent" title=python>PYTHON
<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/categories/%E6%9D%82%E8%B0%88/ class="post_tag button button_translucent" title=杂谈>杂谈
<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/categories/ubuntu/ class="post_tag button button_translucent" title=ubuntu>UBUNTU
<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/categories/%E6%9E%B6%E6%9E%84/ class="post_tag button button_translucent" title=架构>架构
<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/categories/%E8%BF%90%E7%BB%B4/ class="post_tag button button_translucent" title=运维>运维
<span class=button_tally>1</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=series-section>专栏</h2><nav class=tags_nav><a href=https://yaoyl.cn/series/%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA/ class="post_tag button button_translucent" title=基础搭建>基础搭建
<span class=button_tally>4</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=tags-section>标签</h2><nav class=tags_nav><a href=https://yaoyl.cn/tags/c++/ class="post_tag button button_translucent" title=c++>C++
<span class=button_tally>16</span>
</a><a href=https://yaoyl.cn/tags/opengl/ class="post_tag button button_translucent" title=opengl>OPENGL
<span class=button_tally>13</span>
</a><a href=https://yaoyl.cn/tags/java/ class="post_tag button button_translucent" title=java>JAVA
<span class=button_tally>12</span>
</a><a href=https://yaoyl.cn/tags/nehe/ class="post_tag button button_translucent" title=nehe>NEHE
<span class=button_tally>9</span>
</a><a href=https://yaoyl.cn/tags/%E6%BA%90%E7%A0%81/ class="post_tag button button_translucent" title=源码>源码
<span class=button_tally>6</span>
</a><a href=https://yaoyl.cn/tags/ubuntu/ class="post_tag button button_translucent" title=ubuntu>UBUNTU
<span class=button_tally>5</span>
</a><a href=https://yaoyl.cn/tags/%E9%9D%A2%E7%BB%8F/ class="post_tag button button_translucent" title=面经>面经
<span class=button_tally>5</span>
</a><a href=https://yaoyl.cn/tags/%E8%99%9A%E6%8B%9F%E9%A9%BE%E9%A9%B6/ class="post_tag button button_translucent" title=虚拟驾驶>虚拟驾驶
<span class=button_tally>4</span>
</a><a href=https://yaoyl.cn/tags/m1/ class="post_tag button button_translucent" title=m1>M1
<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/macbook/ class="post_tag button button_translucent" title=macbook>MACBOOK
<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/rfid/ class="post_tag button button_translucent" title=rfid>RFID
<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/%E6%A0%A1%E6%8B%9B/ class="post_tag button button_translucent" title=校招>校招
<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/%E7%BD%91%E6%98%93/ class="post_tag button button_translucent" title=网易>网易
<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/%E9%9A%8F%E7%AC%94/ class="post_tag button button_translucent" title=随笔>随笔
<span class=button_tally>3</span></a><br><div class="post_tags_toggle button">所有标签</div><div class=post_tags><div class=tags_list><a href=https://yaoyl.cn/tags/apache/ class="post_tag button button_translucent" data-position=1 title=apache>APACHE<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/bean%E7%AE%A1%E7%90%86/ class="post_tag button button_translucent" data-position=1 title=bean管理>BEAN管理<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/blog/ class="post_tag button button_translucent" data-position=2 title=blog>BLOG<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/c++/ class="post_tag button button_translucent" data-position=16 title=c++>C++<span class=button_tally>16</span>
</a><a href=https://yaoyl.cn/tags/continue/ class="post_tag button button_translucent" data-position=1 title=continue>CONTINUE<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/csdn/ class="post_tag button button_translucent" data-position=1 title=csdn>CSDN<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/c%E8%AF%AD%E8%A8%80/ class="post_tag button button_translucent" data-position=2 title=c语言>C语言<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/docker/ class="post_tag button button_translucent" data-position=2 title=docker>DOCKER<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/ghost/ class="post_tag button button_translucent" data-position=2 title=ghost>GHOST<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/glgenlists/ class="post_tag button button_translucent" data-position=1 title=glgenlists>GLGENLISTS<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/glpolygonm/ class="post_tag button button_translucent" data-position=1 title=glpolygonm>GLPOLYGONM<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/index/ class="post_tag button button_translucent" data-position=1 title=index>INDEX<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/integer/ class="post_tag button button_translucent" data-position=1 title=integer>INTEGER<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/java/ class="post_tag button button_translucent" data-position=12 title=java>JAVA<span class=button_tally>12</span>
</a><a href=https://yaoyl.cn/tags/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class="post_tag button button_translucent" data-position=1 title=lambda表达式>LAMBDA表达式<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/m1/ class="post_tag button button_translucent" data-position=3 title=m1>M1<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/macbook/ class="post_tag button button_translucent" data-position=3 title=macbook>MACBOOK<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/nehe/ class="post_tag button button_translucent" data-position=9 title=nehe>NEHE<span class=button_tally>9</span>
</a><a href=https://yaoyl.cn/tags/ollama/ class="post_tag button button_translucent" data-position=1 title=ollama>OLLAMA<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/opengl/ class="post_tag button button_translucent" data-position=13 title=opengl>OPENGL<span class=button_tally>13</span>
</a><a href=https://yaoyl.cn/tags/python/ class="post_tag button button_translucent" data-position=2 title=python>PYTHON<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/rfid/ class="post_tag button button_translucent" data-position=3 title=rfid>RFID<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/socket/ class="post_tag button button_translucent" data-position=2 title=socket>SOCKET<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/spring/ class="post_tag button button_translucent" data-position=2 title=spring>SPRING<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/ubuntu/ class="post_tag button button_translucent" data-position=5 title=ubuntu>UBUNTU<span class=button_tally>5</span>
</a><a href=https://yaoyl.cn/tags/uml/ class="post_tag button button_translucent" data-position=1 title=uml>UML<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/vs/ class="post_tag button button_translucent" data-position=1 title=vs>VS<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/vscode/ class="post_tag button button_translucent" data-position=1 title=vscode>VSCODE<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E5%8F%98%E6%8D%A2/ class="post_tag button button_translucent" data-position=1 title=变换>变换<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B/ class="post_tag button button_translucent" data-position=1 title=大模型>大模型<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/ class="post_tag button button_translucent" data-position=1 title=多线程>多线程<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/ class="post_tag button button_translucent" data-position=1 title=观察者模式>观察者模式<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/ class="post_tag button button_translucent" data-position=1 title=函数式接口>函数式接口<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E5%8D%8E%E4%B8%BA/ class="post_tag button button_translucent" data-position=1 title=华为>华为<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E6%B7%B7%E5%90%88/ class="post_tag button button_translucent" data-position=1 title=混合>混合<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E6%9E%B6%E6%9E%84/ class="post_tag button button_translucent" data-position=1 title=架构>架构<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/ class="post_tag button button_translucent" data-position=1 title=快捷键>快捷键<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E6%97%85%E6%B8%B8/ class="post_tag button button_translucent" data-position=1 title=旅游>旅游<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E9%9D%A2%E7%BB%8F/ class="post_tag button button_translucent" data-position=5 title=面经>面经<span class=button_tally>5</span>
</a><a href=https://yaoyl.cn/tags/%E7%88%AC%E8%99%AB/ class="post_tag button button_translucent" data-position=2 title=爬虫>爬虫<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/%E9%A3%98%E5%8A%A8/ class="post_tag button button_translucent" data-position=1 title=飘动>飘动<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E5%AE%B9%E5%99%A8/ class="post_tag button button_translucent" data-position=2 title=容器>容器<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/%E8%AE%BE%E8%AE%A1/ class="post_tag button button_translucent" data-position=1 title=设计>设计<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E5%8F%8C%E7%B3%BB%E7%BB%9F/ class="post_tag button button_translucent" data-position=1 title=双系统>双系统<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E9%9A%8F%E7%AC%94/ class="post_tag button button_translucent" data-position=3 title=随笔>随笔<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/%E8%85%BE%E8%AE%AF/ class="post_tag button button_translucent" data-position=1 title=腾讯>腾讯<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E5%9B%BE%E5%BA%8A/ class="post_tag button button_translucent" data-position=1 title=图床>图床<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/ class="post_tag button button_translucent" data-position=2 title=网络编程>网络编程<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/%E7%BD%91%E6%98%93/ class="post_tag button button_translucent" data-position=3 title=网易>网易<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/%E6%96%87%E4%BB%B6%E8%BF%81%E7%A7%BB/ class="post_tag button button_translucent" data-position=1 title=文件迁移>文件迁移<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E6%A0%A1%E6%8B%9B/ class="post_tag button button_translucent" data-position=3 title=校招>校招<span class=button_tally>3</span>
</a><a href=https://yaoyl.cn/tags/%E8%99%9A%E6%8B%9F%E9%A9%BE%E9%A9%B6/ class="post_tag button button_translucent" data-position=4 title=虚拟驾驶>虚拟驾驶<span class=button_tally>4</span>
</a><a href=https://yaoyl.cn/tags/%E5%BC%82%E6%AD%A5%E9%80%9A%E4%BF%A1/ class="post_tag button button_translucent" data-position=1 title=异步通信>异步通信<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E6%BA%90%E4%BB%A3%E7%A0%81/ class="post_tag button button_translucent" data-position=1 title=源代码>源代码<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E6%BA%90%E7%A0%81/ class="post_tag button button_translucent" data-position=6 title=源码>源码<span class=button_tally>6</span>
</a><a href=https://yaoyl.cn/tags/%E8%BF%90%E7%BB%B4/ class="post_tag button button_translucent" data-position=1 title=运维>运维<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E6%9D%82%E8%B0%88/ class="post_tag button button_translucent" data-position=2 title=杂谈>杂谈<span class=button_tally>2</span>
</a><a href=https://yaoyl.cn/tags/%E6%B3%A8%E8%A7%A3/ class="post_tag button button_translucent" data-position=1 title=注解>注解<span class=button_tally>1</span>
</a><a href=https://yaoyl.cn/tags/%E6%B3%A8%E8%A7%A3%E6%89%AB%E6%8F%8F/ class="post_tag button button_translucent" data-position=1 title=注解扫描>注解扫描<span class=button_tally>1</span></a><div class=tags_sort><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span></div><span class=tags_hide><svg class="icon"><use xlink:href="#closeme"/></svg></span></div></div></nav></div></section></aside></div></main><svg width="0" height="0" class="hidden"><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter"><path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68.0 01-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043.0-1.924.366-2.643 1.078A3.56 3.56.0 008.766 5.383c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846.0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47.0.929.273 1.705.82 2.388a3.623 3.623.0 002.115 1.291c-.312.08-.641.118-.979.118-.312.0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652.0 002.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422.0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139.0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77.0 001.172-4.892v-.468a7.788 7.788.0 001.84-1.921 8.142 8.142.0 01-2.11.593z"/></symbol><symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar"><path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916.0 1e2v352c0 33.084 26.916 60 60 60h392c33.084.0 60-26.916 60-60V1e2c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028.0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028.0 20 8.972 20 20v48z"/><path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github"><path d="M255.968 5.329C114.624 5.329.0 120.401.0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384.0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008.0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992.0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584.0 34.368-.32 62.08-.32 70.496.0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab"><path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6.0L12.3 74.8z"/><path d="M12.3 74.7.5 111c-1 3.2.0 6.8 3 8.8l101.6 74-92.5-119z"/><path d="M105 193.7l-38.6-119h-54l92.7 119z"/><path d="M105 193.7l38.7-119H66.4l38.7 119z"/><path d="M105 193.7l38.7-119H198l-93 119z"/><path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/><path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6.0L198 74.8z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss"><circle cx="3.429" cy="20.571" r="3.429"/><path d="M11.429 24h4.57C15.999 15.179 8.821 8.001.0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"/><path d="M24 24C24 10.766 13.234.0.0.0v4.571c10.714.0 19.43 8.714 19.43 19.429z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h362c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top"><path d="M604.501 440.509 325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298.0 36.323s26.223 10.024 36.222.0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221.0 9.999-10.023 9.999-26.298.0-36.323z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly"><path d="M504.971 239.029 448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c19.851.0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002.0 004e2 320v108c0 19.851-16.149 36-36 36h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c46.318.0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568.0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255.0 24-10.745 24-24S205.255.0 192 0h-44c-46.318.0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568.0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255.0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851.0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002.0 00112 192z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy"><path d="M23 2.75A2.75 2.75.0 0020.25.0H8.75A2.75 2.75.0 006 2.75v13.5A2.75 2.75.0 008.75 19h11.5A2.75 2.75.0 0023 16.25zM18.25 14.5h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5z"/><path d="M8.75 20.5A4.255 4.255.0 014.5 16.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752.0 001 5.25v16A2.752 2.752.0 003.75 24h12a2.752 2.752.0 002.75-2.75v-.75z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme"><path d="M284.286 256.002 506.143 34.144c7.811-7.811 7.811-20.475.0-28.285-7.811-7.81-20.475-7.811-28.285.0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285.0-7.81 7.811-7.811 20.475.0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475.0 28.285a19.938 19.938.0 0014.143 5.857 19.94 19.94.0 0014.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475.0-28.285L284.286 256.002z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu"><path d="M492 236H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954.0 96s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram"><path d="M12 2.163c3.204.0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849.0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204.0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849.0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741.0 8.333.014 7.053.072c-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.668.072 4.948c.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24s3.668-.014 4.948-.072c4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403.0-6.162 2.759-6.162 6.162S8.597 18.163 12 18.163s6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zM12 16c-2.209.0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796.0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795.0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="youtube"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow"><path d="M21 27v-8h3v11H0V19h3v8h18z"/><path d="M17.1.2 15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8 13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord"><path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527.41542 45.5603.39851 45.468.440769 45.4204.525289 44.7963 1.6353 44.105 3.0834 43.6209 4.2216c-5.4572-.817-10.8864-.817-16.2317.0C26.905 3.0581 26.1886 1.6353 25.5617.525289 25.5141.443589 25.4218.40133 25.3294.41542c-5.071.87338-9.9237 2.40318-14.4518 4.48238C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795 1.57795 18.7309-.943561 32.1443.293408 45.3914.299005 45.4562.335386 45.5182.385761 45.5576 6.45866 50.0174 12.3413 52.7249 18.1147 54.5195 18.2071 54.5477 18.305 54.5139 18.3638 54.4378 19.7295 52.5728 20.9469 50.6063 21.9907 48.5383 22.0523 48.4172 21.9935 48.2735 21.8676 48.2256 19.9366 47.4931 18.0979 46.6 16.3292 45.5858 16.1893 45.5041 16.1781 45.304 16.3068 45.2082 16.679 44.9293 17.0513 44.6391 17.4067 44.3461 17.471 44.2926 17.5606 44.2813 17.6362 44.3151c11.6196 5.3051 24.1992 5.3051 35.6817.0C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433 53.9057 44.6363 54.2779 44.9293 54.6529 45.2082 54.7816 45.304 54.7732 45.5041 54.6333 45.5858c-1.7687 1.0339-3.6074 1.9073-5.5412 2.637C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383c1.0662 2.0651 2.2836 4.0316 3.6241 5.8967C52.6519 54.5139 52.7526 54.5477 52.845 54.5195c5.8014-1.7946 11.684-4.5021 17.7569-8.9619C70.6551 45.5182 70.6887 45.459 70.6943 45.3942 72.1747 30.0791 68.2147 16.7757 60.1968 4.9823 60.1772 4.9429 60.1437 4.9147 60.1045 4.8978zM23.7259 37.3253c-3.4983.0-6.3808-3.2117-6.3808-7.156s2.8266-7.156 6.3808-7.156c3.5821.0 6.4367 3.2399 6.3807 7.156.0 3.9443-2.8266 7.156-6.3807 7.156zm23.5919.0c-3.4982.0-6.3807-3.2117-6.3807-7.156s2.8265-7.156 6.3807-7.156c3.5822.0 6.4367 3.2399 6.3808 7.156.0 3.9443-2.7986 7.156-6.3808 7.156z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 18" id="mastodon"><path fill="#fff" d="m15.054695 9.8859583c-.22611 1.1632697-2.02517 2.4363497-4.09138 2.6830797-1.0774504.12856-2.1382704.24673-3.2694704.19484-1.84996-.0848-3.30971-.44157-3.30971-.44157.0.1801.0111.35157.0333.51194.24051 1.82571 1.81034 1.93508 3.29737 1.98607 1.50088.0514 2.8373104-.37004 2.8373104-.37004l.0617 1.35686s-1.0498104.56374-2.9199404.66742c-1.03124.0567-2.3117-.0259-3.80308-.42069-3.23454998-.85613-3.79081998-4.304-3.87592998-7.8024197-.026-1.03871-.01-2.01815-.01-2.83732.0-3.57732 2.34385998-4.62587996 2.34385998-4.62587996 1.18184-.54277 3.20976-.77101 5.318-.7882499985409h.0518C9.8267646.01719834 11.856025.24547834 13.037775.78824834c0 0 2.34377 1.04855996 2.34377 4.62587996.0.0.0294 2.63937-.32687 4.47183"/><path fill="#000" d="m12.616925 5.6916583v4.3315297h-1.71607V5.8189683c0-.88624-.37289-1.33607-1.1187604-1.33607-.82467.0-1.23799.53361-1.23799 1.58875v2.30122h-1.70594v-2.30122c0-1.05514-.4134-1.58875-1.23808-1.58875-.74587.0-1.11876.44983-1.11876 1.33607v4.2042197h-1.71607V5.6916583c0-.88527.22541-1.58876.67817-2.10922.46689-.52047 1.07833-.78727 1.83735-.78727.87816.0 1.54317.33752 1.98288 1.01267l.42744.71655.42753-.71655c.43961-.67515 1.10463-1.01267 1.9828704-1.01267.75893.0 1.37037.2668 1.83735.78727.45268.52046.67808 1.22395.67808 2.10922"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 530" id="bluesky"><path d="m135.72 44.03C202.216 93.951 273.74 195.17 3e2 249.49c26.262-54.316 97.782-155.54 164.28-205.46C512.26 8.009 590-19.862 590 68.825c0 17.712-10.155 148.79-16.111 170.07-20.703 73.984-96.144 92.854-163.25 81.433 117.3 19.964 147.14 86.092 82.697 152.22-122.39 125.59-175.91-31.511-189.63-71.766-2.514-7.3797-3.6904-10.832-3.7077-7.8964-.0174-2.9357-1.1937.51669-3.7077 7.8964-13.714 40.255-67.233 197.36-189.63 71.766-64.444-66.128-34.605-132.26 82.697-152.22-67.108 11.421-142.55-7.4491-163.25-81.433-5.9562-21.282-16.111-152.36-16.111-170.07.0-88.687 77.742-60.816 125.72-24.795z"/><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" id="ko-fi"><path fill="#fff" d="M4.5 9.8527H32.7947a0 0 0 010 0v19.225a9.07 9.07.0 01-9.07 9.07H13.57a9.07 9.07.0 01-9.07-9.07V9.8527a0 0 0 010 0z"/><path fill="#000" d="M12.197 25.9493l6.45 6.45 6.45-6.45a8.2 8.2.0 002.4016-5.798h0a4.5082 4.5082.0 00-4.212-4.5459 4.4262 4.4262.0 00-4.64 4.4209 4.4261 4.4261.0 00-4.64-4.4209 4.5082 4.5082.0 00-4.212 4.5459h0a8.2 8.2.0 002.4024 5.798z"/><path fill="#fff" d="M32.7947 9.8527H35.73a7.77 7.77.0 010 15.5394H32.7947"/></svg></symbol></svg><footer class=footer><div class="footer_inner wrap pale"><img src=https://yaoyl.cn/icons/apple-touch-icon.png class="icon icon_2 transparent" alt="Copyright © 2017–2025, Yunyao Long and the Hugo Authors; 粤ICP备-17050867-1号"><p>Copyright&nbsp;<span class=year></span>&nbsp;COPYRIGHT © 2017–2025, YUNYAO LONG AND THE HUGO AUTHORS; 粤ICP备-17050867-1号. All Rights Reserved</p><a class=to_top href=#documentTop><svg class="icon"><title>to-top</title><use xlink:href="#to-top"/></svg></a></div></footer><script type=text/javascript src=https://yaoyl.cn/zh/js/bundle.a218cea21dfa8b9c5346bc507dae1a9753e4e347b6bdb2e71b8684278779920ccb8c67121f2b77caa97cc3bb82e1f55b11cfea79e196aaafe8c20be128212e2b.js integrity="sha512-ohjOoh36i5xTRrxQfa4al1Pk40e2vbLnG4aEJ4d5kgzLjGcSHyt3yql8w7uC4fVbEc/qeeGWqq/owgvhKCEuKw==" crossorigin=anonymous></script><script src=https://yaoyl.cn/js/search.min.8d141e1e7aa85984a5288b2172ad03540fc235f64379f8df11d062fd3deb9d49bbd9fb0f3df983e9663e322fa8e322a336d5350fbe833c77eb9ee7d907636cff.js></script></body></html>